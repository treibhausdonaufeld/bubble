apiVersion: v1
kind: Secret
metadata:
  name: {{ include "bubble.fullname" . }}-backend
  labels:
    {{- include "bubble.labels" . | nindent 4 }}
type: Opaque
stringData:
  DJANGO_SECRET_KEY: {{ .Values.backend.secrets.secretKey | quote }}
  GEMINI_API_KEY: {{ .Values.backend.secrets.geminiApiKey | default "not_set" | quote }}
  MAILGUN_API_KEY: {{ .Values.backend.secrets.mailgunApiKey | default "not_set" | quote }}
  MAILGUN_DOMAIN: {{ .Values.backend.secrets.mailgunDomain | default "not_set" | quote }}
---
{{- if .Values.postgresql.enabled }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "bubble.fullname" . }}-postgresql
  labels:
    {{- include "bubble.labels" . | nindent 4 }}
type: Opaque
stringData:
  password: {{ .Values.postgresql.auth.password | quote }}
  postgres-password: {{ .Values.postgresql.auth.postgresPassword | quote }}
  POSTGRES_USER: {{ .Values.postgresql.auth.username | quote }}
  POSTGRES_PASSWORD: {{ .Values.postgresql.auth.password | quote }}
  POSTGRES_DB: {{ .Values.postgresql.auth.database | quote }}
{{- end }}
---
{{- if and (not .Values.postgresql.enabled) (not .Values.externalPostgresql.existingSecret) }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "bubble.fullname" . }}-external-postgresql
  labels:
    {{- include "bubble.labels" . | nindent 4 }}
type: Opaque
stringData:
  password: {{ .Values.externalPostgresql.password | quote }}
{{- end }}
---
{{- if and (not .Values.redis.enabled) .Values.externalRedis.password (not .Values.externalRedis.existingSecret) }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "bubble.fullname" . }}-external-redis
  labels:
    {{- include "bubble.labels" . | nindent 4 }}
type: Opaque
stringData:
  password: {{ .Values.externalRedis.password | quote }}
{{- end }}
